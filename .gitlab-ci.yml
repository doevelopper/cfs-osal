#
# To check this script syntax: https://gitlab.com/doevelopper/cfs-osal/-/ci/lint
#
# sudo usermod -a -G sudo gitlab-runner
# sudo visudo or sudo vi /etc/sudoers
# %gitlab-runner ALL=(ALL) NOPASSWD: ALL

stages:
    - configure
    - compile
    - test-compile
    - unit-test
    - target-package
    - feature-test
    - verify
    - code-review
    - target-install
    - site
    - deploy
    - target-clean

validate:
    stage: configure
    before_script:
        - echo $CI_PIPELINE_ID
        - echo "Validate ${CI_PROJECT_NAME} is correct and all necessary information is available."
        - mkdir -p $HOME/.local
        - export PATH=$HOME/.local/bin:$PATH

    script:
        - >
           if [ ! -d "${BUILD_DIRECTORY}" ]; then
               cmake -E make_directory ${BUILD_DIRECTORY}
           fi
        - cmake -E chdir  ${BUILD_DIRECTORY} cmake .. -G"Unix Makefiles" -DCMAKE_BUILD_TYPE=DEBUG -DCMAKE_INSTALL_PREFIX=/opt/dds
        - cmake --build  ${BUILD_DIRECTORY} --target all --clean-first
        - cmake --build  ${BUILD_DIRECTORY} --target test
    after_script:
        - echo "${BUILD_DIRECTORY} directory created"


